<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tồn Kho Pharm</title>
    <link rel="icon" type="image/png" href="https://images.seeklogo.com/logo-png/50/1/johnson-johnson-logo-png_seeklogo-500414.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.23/dist/jspdf.plugin.autotable.min.js"></script>
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .modal-backdrop { background-color: rgba(0, 0, 0, 0.5); }
        .nav-button.active { background-color: #374151; color: #f3f4f6; }
        .table-container { height: 100%; overflow-y: auto; }
        thead th { position: sticky; top: 0; z-index: 10; background-color: #f9fafb; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        #toast-container {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .toast {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            color: white;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease-in-out;
        }
        .toast.show { opacity: 1; transform: translateX(0); }
        .toast.hide { opacity: 0; transform: translateX(100%); }
        .toast-success { background-color: #28a745; }
        .toast-error { background-color: #dc3545; }
        .toast-info { background-color: #17a2b8; }

        .filter-popover {
            position: absolute;
            z-index: 40;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            width: 280px;
            padding: 0.75rem;
        }
        .filter-options-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 0.5rem;
            margin-bottom: 0.5rem;
        }

        /* View Transition: Make views stack for a smooth cross-fade */
        #view-container {
            position: relative;
        }
        .app-view {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
            pointer-events: none; /* Inactive views are not interactive */
        }
        .app-view.active {
            opacity: 1;
            pointer-events: auto; /* Active view is interactive */
        }


        /* Progress Bar */
        #progress-bar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            z-index: 9998;
            background-color: transparent;
        }
        .progress-bar-inner {
            height: 100%;
            width: 0;
            background-color: #3b82f6;
            transition: width 0.3s ease-out;
            border-radius: 0 2px 2px 0;
            position: relative;
            overflow: hidden;
        }
        .progress-bar-inner::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background-image: linear-gradient(
                -45deg,
                rgba(255, 255, 255, 0.2) 25%,
                transparent 25%,
                transparent 50%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0.2) 75%,
                transparent 75%,
                transparent
            );
            background-size: 50px 50px;
            animation: progress-shimmer 2s linear infinite;
        }
        @keyframes progress-shimmer {
            0% { background-position: 0 0; }
            100% { background-position: 50px 50px; }
        }

        /* Announcement Bar Animation */
        @keyframes marquee {
            0%   { transform: translateX(100%); }
            /* Scroll takes 40s, pause takes 1s. Total duration = 41s. */
            /* Movement phase: (40 / 41) * 100 = ~97.5% */
            97.5% { transform: translateX(-100%); }
            100% { transform: translateX(-100%); }
        }
        .animate-marquee {
            display: inline-block;
            padding-left: 100%; /* Start off-screen */
            /* Total duration 41s */
            animation: marquee 41s linear infinite;
        }

    </style>
</head>
<body class="bg-gray-100 font-sans antialiased">

    <div id="toast-container"></div>

    <div id="main-app" class="hidden">
        <div class="flex h-screen bg-gray-200">
            <div id="sidebar" class="fixed inset-y-0 left-0 z-30 w-64 transform transition-all duration-300 ease-in-out bg-gray-900 text-gray-200 no-scrollbar overflow-y-auto flex flex-col">
                <div class="flex items-center justify-between p-4 border-b border-gray-700 flex-shrink-0">
                    <div class="flex items-center">
                         <img id="sidebar-avatar" src="" alt="Avatar" class="h-10 w-10 rounded-full object-cover mr-3 flex-shrink-0">
                        <div id="user-details" class="transition-opacity duration-300">
                            <span class="font-semibold text-lg" id="user-ho-ten">Đang tải...</span>
                            <span class="text-xs text-gray-400 block" id="user-gmail">...</span>
                        </div>
                    </div>
                    <button id="sidebar-toggle-btn" class="p-2 rounded-full hover:bg-gray-700">
                        <svg id="sidebar-toggle-icon-close" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path></svg>
                        <svg id="sidebar-toggle-icon-open" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"></path></svg>
                    </button>
                </div>

                <nav class="mt-4 flex-grow">
                    <button data-view="view-san-pham" class="nav-button w-full flex items-center px-6 py-3 text-gray-400 hover:bg-gray-700 active">
                        <svg class="w-6 h-6 mr-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path></svg>
                        <span class="nav-text transition-opacity duration-300">Sản Phẩm</span>
                    </button>
                    <button data-view="view-don-hang" class="nav-button w-full flex items-center px-6 py-3 text-gray-400 hover:bg-gray-700">
                        <svg class="w-6 h-6 mr-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                        <span class="nav-text transition-opacity duration-300">Đơn Hàng</span>
                    </button>
                    <button data-view="view-chi-tiet" class="nav-button w-full flex items-center px-6 py-3 text-gray-400 hover:bg-gray-700">
                        <svg class="w-6 h-6 mr-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        <span class="nav-text transition-opacity duration-300">Chi Tiết</span>
                    </button>
                    <button data-view="view-cai-dat" class="nav-button w-full flex items-center px-6 py-3 text-gray-400 hover:bg-gray-700">
                         <svg class="w-6 h-6 mr-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0 3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826 3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path></svg>
                        <span class="nav-text transition-opacity duration-300">Cài Đặt</span>
                    </button>
                </nav>

                <div id="sidebar-footer" class="p-4 text-center text-xs text-gray-400 flex-shrink-0 transition-opacity duration-300">
                    <p class="font-semibold">Phiên bản 001</p>
                    <p>Phát triển bởi Thái Trung Tín</p>
                    <p>Zalo: 0364605514</p>
                </div>
            </div>

            <div id="main-content-area" class="relative flex-1 flex flex-col ml-64 transition-all duration-300 ease-in-out">
                <div id="user-announcement-bar" class="hidden bg-yellow-200 text-yellow-900 px-4 py-2 text-sm overflow-hidden whitespace-nowrap z-20">
                    <p class="announcement-text animate-marquee"></p>
                </div>
                <div id="progress-bar" class="hidden">
                    <div class="progress-bar-inner"></div>
                </div>
                <main id="view-container" class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-4 md:p-6">
                    <!-- View HTML will be loaded here by JavaScript -->
                </main>
            </div>
        </div>
    </div>

    <!-- Modals will be loaded into this container -->
    <div id="modal-container"></div>
    
    <div id="loading-overlay" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop hidden">
        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-blue-500"></div>
    </div>

    <div id="app-loading" class="flex items-center justify-center min-h-screen">
        <p class="text-gray-600 text-lg">Đang kiểm tra phiên đăng nhập...</p>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>